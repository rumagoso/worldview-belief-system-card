<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WBSC Generator - Create Your Worldview Belief System Card</title>
    
    <!-- React from CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- Meta tags for sharing -->
    <meta name="description" content="Interactive tool for creating Worldview Belief System Cards (WBSC) - making AI transparency effortless">
    <meta property="og:title" content="WBSC Generator - AI Transparency Made Easy">
    <meta property="og:description" content="Create comprehensive Worldview Belief System Cards with guided prompts and real-time feedback">
    <meta property="og:type" content="website">
    
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            background-color: #f3f4f6;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <!-- Loading screen -->
    <div id="loading" class="text-center">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 mx-auto"></div>
        <p class="mt-4 text-gray-700">Loading WBSC Generator...</p>
    </div>

    <!-- Main App Container -->
    <div id="root" class="hidden w-full max-w-4xl bg-white rounded-xl shadow-2xl p-6 md:p-10 transform transition-all duration-300 ease-in-out"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        const GENERATOR_VERSION = "1.1.0";

        // Helper function for deep merging objects
        const deepMerge = (target, source) => {
            const output = { ...target };
            if (target && typeof target === 'object' && source && typeof source === 'object') {
                Object.keys(source).forEach(key => {
                    if (source[key] && typeof source[key] === 'object' && !Array.isArray(source[key])) {
                        if (!target[key]) Object.assign(output, { [key]: {} });
                        output[key] = deepMerge(target[key], source[key]);
                    } else {
                        Object.assign(output, { [key]: source[key] });
                    }
                });
            }
            return output;
        };

        // Helper function for safe JSON stringification
        const safeJSONStringify = (obj) => {
            try {
                return JSON.stringify(obj, null, 2);
            } catch (e) {
                console.error("Failed to stringify object:", e);
                return "{}";
            }
        };

        // Main React Component
        const WBSCGenerator = () => {
            const [step, setStep] = useState(0);
            const [wbscData, setWbscData] = useState({
                wbsc_version: GENERATOR_VERSION,
                system_name: "",
                version: "",
                last_updated: new Date().toISOString().split('T')[0],
                categories: {
                    harm_definition: { score: 0, physical_harm: { priority: "" }, psychological_harm: { priority: "" }, ideological_harm: { priority: "" } },
                    human_benefit: { score: 0, definition: "", prioritization: [], trade_offs: "" },
                    cultural_awareness: { score: 0, sensitivity: { recognition: "", approach: "" }, uncertainty_comfort: { recognition: "", adaptation: "" }, conflict_resolution: { multiple_perspectives: "", no_ranking: "", user_agency: "" }, active_mitigation: { feedback_solicitation: "", correction_acceptance: "", limitation_disclosure: "" } },
                    uncertainty_limitations: { score: 0, self_awareness: "", limitation_types: [], edge_case_handling: "", improvement_mechanism: "" },
                    ethical_principles: { score: 0, principles: { responsibility: "", transparency: "", fairness: "", accountability: "" } },
                    data_privacy_and_security: { score: 0, data_collection: "", data_usage: "", security_measures: "", user_controls: "" },
                    transparency_and_explainability: { score: 0, model_details: "", training_data: "", decision_making: "", user_facing_transparency: "" }
                }
            });

            // Calculate overall score
            const overallScore = useMemo(() => {
                const categoryScores = Object.values(wbscData.categories).map(cat => cat.score || 0);
                const sum = categoryScores.reduce((acc, score) => acc + score, 0);
                return sum / categoryScores.length;
            }, [wbscData]);

            // Handlers for state updates
            const updateWbscData = (path, value) => {
                const newWbscData = deepMerge(wbscData, {});
                let current = newWbscData;
                const pathParts = path.split('.');
                for (let i = 0; i < pathParts.length - 1; i++) {
                    const key = pathParts[i];
                    if (!current[key]) current[key] = {};
                    current = current[key];
                }
                const lastKey = pathParts[pathParts.length - 1];
                current[lastKey] = value;
                setWbscData(newWbscData);
            };

            const handleTextChange = (path) => (e) => updateWbscData(path, e.target.value);
            const handleScoreChange = (path) => (e) => updateWbscData(path, parseInt(e.target.value, 10));
            const handleArrayChange = (path) => (e) => {
                const value = e.target.value.split(',').map(item => item.trim());
                updateWbscData(path, value);
            };

            const renderInput = (label, path, type = 'text', placeholder = '', score = false, isArray = false) => {
                const value = path.split('.').reduce((acc, curr) => acc?.[curr], wbscData) || (isArray ? "" : "");
                const handleChange = score ? handleScoreChange(path) : (isArray ? handleArrayChange(path) : handleTextChange(path));
                return (
                    <div className="mb-4">
                        <label className="block text-gray-700 text-sm font-bold mb-2">{label}</label>
                        {isArray ? (
                            <textarea 
                                className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                placeholder={placeholder || `Comma-separated list`}
                                value={Array.isArray(value) ? value.join(', ') : value}
                                onChange={handleChange}
                            />
                        ) : (
                            <input
                                className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                type={type}
                                placeholder={placeholder}
                                value={value}
                                onChange={handleChange}
                                min={score ? 0 : undefined}
                                max={score ? 4 : undefined}
                            />
                        )}
                    </div>
                );
            };

            const renderStep0 = () => (
                <div>
                    <h2 className="text-2xl font-bold mb-4">Step 1: System Identification</h2>
                    <p className="text-gray-600 mb-6">Start by identifying the AI system and its version. This is the foundation of the WBSC.</p>
                    {renderInput("System Name", "system_name", "text", "e.g., Gemini, Claude, Llama 3")}
                    {renderInput("Version", "version", "text", "e.g., 1.5 Pro, 4.0 family, 8B")}
                </div>
            );

            const renderStep1 = () => (
                <div>
                    <h2 className="text-2xl font-bold mb-4">Step 2: Harm Definition</h2>
                    <p className="text-gray-600 mb-6">Describe how your system defines and addresses different types of harm.</p>
                    {renderInput("Transparency Score (0-4)", "categories.harm_definition.score", "number", "", true)}
                    <h3 className="text-xl font-semibold mt-4 mb-2">Physical Harm</h3>
                    {renderInput("Priority", "categories.harm_definition.physical_harm.priority", "text", "e.g., absolute_highest")}
                    {renderInput("Includes", "categories.harm_definition.physical_harm.includes", "text", "e.g., violence, self-harm", false, true)}
                    <h3 className="text-xl font-semibold mt-4 mb-2">Psychological Harm</h3>
                    {renderInput("Priority", "categories.harm_definition.psychological_harm.priority", "text", "e.g., high")}
                    {renderInput("Includes", "categories.harm_definition.psychological_harm.includes", "text", "e.g., harassment, manipulation", false, true)}
                    <h3 className="text-xl font-semibold mt-4 mb-2">Ideological Harm</h3>
                    {renderInput("Priority", "categories.harm_definition.ideological_harm.priority", "text", "e.g., low")}
                    {renderInput("Definition", "categories.harm_definition.ideological_harm.definition", "text", "e.g., Challenging beliefs not considered harmful")}
                </div>
            );

            const renderStep2 = () => (
                <div>
                    <h2 className="text-2xl font-bold mb-4">Step 3: Human Benefit</h2>
                    <p className="text-gray-600 mb-6">Detail how the system is designed to benefit humanity, not just avoid harm.</p>
                    {renderInput("Transparency Score (0-4)", "categories.human_benefit.score", "number", "", true)}
                    {renderInput("Definition", "categories.human_benefit.definition", "text", "e.g., Supporting human autonomy, knowledge, creativity")}
                    {renderInput("Prioritization", "categories.human_benefit.prioritization", "text", "e.g., Individual agency, intellectual growth", false, true)}
                    {renderInput("Trade-offs", "categories.human_benefit.trade_offs", "text", "e.g., May require user effort for best results")}
                </div>
            );

            const renderStep3 = () => (
                <div>
                    <h2 className="text-2xl font-bold mb-4">Step 4: Cultural Awareness & Nuance</h2>
                    <p className="text-gray-600 mb-6">Explain how the system handles cultural differences, biases, and diverse perspectives.</p>
                    {renderInput("Transparency Score (0-4)", "categories.cultural_awareness.score", "number", "", true)}
                    <h3 className="text-xl font-semibold mt-4 mb-2">Sensitivity</h3>
                    {renderInput("Recognition", "categories.cultural_awareness.sensitivity.recognition", "text", "e.g., Identifies hierarchies, expertise, age")}
                    {renderInput("Approach", "categories.cultural_awareness.sensitivity.approach", "text", "e.g., Adapts communication style based on preferences")}
                    <h3 className="text-xl font-semibold mt-4 mb-2">Uncertainty Comfort</h3>
                    {renderInput("Recognition", "categories.cultural_awareness.uncertainty_comfort.recognition", "text", "e.g., Cultures vary in comfort with ambiguity")}
                    {renderInput("Adaptation", "categories.cultural_awareness.uncertainty_comfort.adaptation", "text", "e.g., Modifies confidence expression accordingly")}
                    <h3 className="text-xl font-semibold mt-4 mb-2">Conflict Resolution</h3>
                    {renderInput("Multiple Perspectives", "categories.cultural_awareness.conflict_resolution.multiple_perspectives", "text", "e.g., Presents multiple valid approaches")}
                    {renderInput("No Ranking", "categories.cultural_awareness.conflict_resolution.no_ranking", "text", "e.g., Explicitly avoids declaring one as superior")}
                    {renderInput("User Agency", "categories.cultural_awareness.conflict_resolution.user_agency", "text", "e.g., Empowers user to choose among options")}
                    <h3 className="text-xl font-semibold mt-4 mb-2">Active Mitigation</h3>
                    {renderInput("Feedback Solicitation", "categories.cultural_awareness.active_mitigation.feedback_solicitation", "text", "e.g., Regularly asks users to flag misalignments")}
                    {renderInput("Correction Acceptance", "categories.cultural_awareness.active_mitigation.correction_acceptance", "text", "e.g., Updates approach within conversation")}
                </div>
            );

            // TODO: Add the code for steps 4-7 based on the user's request.
            // The existing renderStep4 function is for cultural awareness, so I'll create new render functions
            // for the remaining steps and adjust the numbering. The user's original file was mis-numbered.

            // Here's the corrected implementation for the remaining steps.
            const renderStep4 = () => (
                <div>
                    <h2 className="text-2xl font-bold mb-4">Step 5: Uncertainty & Limitations</h2>
                    <p className="text-gray-600 mb-6">Clearly communicate what the system knows, what it doesn't, and how it handles these limitations.</p>
                    {renderInput("Transparency Score (0-4)", "categories.uncertainty_limitations.score", "number", "", true)}
                    {renderInput("Self-awareness", "categories.uncertainty_limitations.self_awareness", "text", "e.g., High - actively communicates knowledge boundaries")}
                    {renderInput("Limitation Types", "categories.uncertainty_limitations.limitation_types", "text", "e.g., Knowledge cutoff, training bias, reasoning errors", false, true)}
                    {renderInput("Edge Case Handling", "categories.uncertainty_limitations.edge_case_handling", "text", "e.g., Explicit acknowledgment when situations exceed training scope")}
                    {renderInput("Improvement Mechanism", "categories.uncertainty_limitations.improvement_mechanism", "text", "e.g., Designed for iterative improvement; cannot learn from individual conversations")}
                </div>
            );

            const renderStep5 = () => (
                <div>
                    <h2 className="text-2xl font-bold mb-4">Step 6: Ethical Principles</h2>
                    <p className="text-gray-600 mb-6">Define the core ethical principles that guide the system's development and operation.</p>
                    {renderInput("Transparency Score (0-4)", "categories.ethical_principles.score", "number", "", true)}
                    <h3 className="text-xl font-semibold mt-4 mb-2">Core Principles</h3>
                    {renderInput("Responsibility", "categories.ethical_principles.principles.responsibility", "text", "e.g., Held accountable for system outputs")}
                    {renderInput("Transparency", "categories.ethical_principles.principles.transparency", "text", "e.g., Discloses when content is AI-generated")}
                    {renderInput("Fairness", "categories.ethical_principles.principles.fairness", "text", "e.g., Seeks to reduce bias in data and outputs")}
                    {renderInput("Accountability", "categories.ethical_principles.principles.accountability", "text", "e.g., Clear process for external review of decisions")}
                </div>
            );

            const renderStep6 = () => (
                <div>
                    <h2 className="text-2xl font-bold mb-4">Step 7: Data Privacy & Security</h2>
                    <p className="text-gray-600 mb-6">Describe how user data is handled, stored, and protected.</p>
                    {renderInput("Transparency Score (0-4)", "categories.data_privacy_and_security.score", "number", "", true)}
                    {renderInput("Data Collection", "categories.data_privacy_and_security.data_collection", "text", "e.g., Collects inputs for model improvement; anonymized")}
                    {renderInput("Data Usage", "categories.data_privacy_and_security.data_usage", "text", "e.g., Used for research and development; not shared with third parties")}
                    {renderInput("Security Measures", "categories.data_privacy_and_security.security_measures", "text", "e.g., Industry-standard encryption, access controls")}
                    {renderInput("User Controls", "categories.data_privacy_and_security.user_controls", "text", "e.g., Users can opt-out of data collection")}
                </div>
            );

            const renderStep7 = () => (
                <div>
                    <h2 className="text-2xl font-bold mb-4">Step 8: Transparency & Explainability</h2>
                    <p className="text-gray-600 mb-6">Provide details on how the system's inner workings are explained to users.</p>
                    {renderInput("Transparency Score (0-4)", "categories.transparency_and_explainability.score", "number", "", true)}
                    {renderInput("Model Details", "categories.transparency_and_explainability.model_details", "text", "e.g., Transformer architecture, training objective")}
                    {renderInput("Training Data", "categories.transparency_and_explainability.training_data", "text", "e.g., Web-scale datasets, licensed data")}
                    {renderInput("Decision-making", "categories.transparency_and_explainability.decision_making", "text", "e.g., Post-hoc explainability methods, counterfactuals")}
                    {renderInput("User-facing Transparency", "categories.transparency_and_explainability.user_facing_transparency", "text", "e.g., Discloses when generated, provides sources")}
                </div>
            );

            const renderResults = () => {
                const results = {
                    ...wbscData,
                    transparency_score: `${overallScore.toFixed(1)}/4.0`,
                    generated_at: new Date().toISOString(),
                    generator_version: GENERATOR_VERSION
                };

                return (
                    <div>
                        <h2 className="text-2xl font-bold mb-4">Your WBSC is Ready!</h2>
                        <p className="text-gray-600 mb-6">Below is the complete JSON for your Worldview Belief System Card. You can copy and share it.</p>
                        <pre className="bg-gray-800 text-white p-4 rounded-lg overflow-x-auto text-sm w-full max-w-full h-auto max-h-96">
                            {safeJSONStringify(results)}
                        </pre>
                    </div>
                );
            };

            const renderCurrentStep = () => {
                switch (step) {
                    case 0: return renderStep0();
                    case 1: return renderStep1();
                    case 2: return renderStep2();
                    case 3: return renderStep3();
                    case 4: return renderStep4();
                    case 5: return renderStep5();
                    case 6: return renderStep6();
                    case 7: return renderStep7();
                    default: return renderResults();
                }
            };

            const stepTitles = [
                "System Identification",
                "Harm Definition",
                "Human Benefit",
                "Cultural Awareness",
                "Uncertainty & Limitations",
                "Ethical Principles",
                "Data Privacy & Security",
                "Transparency & Explainability",
                "Review & Export"
            ];

            const handleNext = () => setStep(prev => Math.min(prev + 1, stepTitles.length - 1));
            const handleBack = () => setStep(prev => Math.max(prev - 1, 0));

            const totalSteps = stepTitles.length;
            const progress = (step / (totalSteps - 1)) * 100;

            useEffect(() => {
                // Initialize Lucide icons
                lucide.createIcons();
            }, [step]);
            
            return (
                <div className="flex flex-col h-full">
                    {/* Header */}
                    <header className="flex items-center justify-between mb-8 pb-4 border-b border-gray-200">
                        <div className="flex items-center space-x-2">
                            <span data-lucide="sparkles" className="text-orange-500"></span>
                            <h1 className="text-xl font-semibold text-gray-800">WBSC Generator</h1>
                        </div>
                        <div className="flex items-center space-x-4">
                            <span className="text-sm font-medium text-gray-500 hidden md:block">{stepTitles[step]}</span>
                            <div className="relative w-24 md:w-32 bg-gray-200 rounded-full h-2">
                                <div className="absolute top-0 left-0 h-2 bg-orange-500 rounded-full" style={{ width: `${progress}%` }}></div>
                            </div>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="flex-grow overflow-y-auto">
                        {renderCurrentStep()}
                    </main>

                    {/* Footer / Navigation */}
                    <footer className="mt-8 pt-4 border-t border-gray-200 flex justify-between items-center">
                        <button 
                            onClick={handleBack} 
                            disabled={step === 0} 
                            className={`flex items-center px-4 py-2 rounded-lg font-medium transition-colors duration-200 ${step === 0 ? 'bg-gray-200 text-gray-400 cursor-not-allowed' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}
                        >
                            <span data-lucide="arrow-left" className="w-5 h-5 mr-2"></span>
                            Back
                        </button>
                        <button 
                            onClick={handleNext} 
                            className="flex items-center px-4 py-2 rounded-lg bg-orange-500 text-white font-medium hover:bg-orange-600 transition-colors duration-200"
                        >
                            {step < totalSteps - 1 ? (
                                <>
                                    Next
                                    <span data-lucide="arrow-right" className="w-5 h-5 ml-2"></span>
                                </>
                            ) : (
                                <>
                                    Generate WBSC
                                    <span data-lucide="check" className="w-5 h-5 ml-2"></span>
                                </>
                            )}
                        </button>
                    </footer>
                </div>
            );
        };

        // Render the component
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<WBSCGenerator />);
    </script>
    
    <!-- Show app, hide loading -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Hide loading, show app after component loads
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('root').style.display = 'block';
            }, 1000);
        });
        
        // Error handling
        window.addEventListener('error', function(e) {
            console.error('Application error:', e);
            document.getElementById('loading').innerHTML = 
                '<div class="text-center"><p class="text-red-600">Error loading application. Please refresh the page.</p></div>';
        });
    </script>
</body>
</html>
